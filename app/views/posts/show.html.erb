<div class="max-w-6xl mx-auto my-16">
  <div class="border rounded-lg bg-gray-50 p-16 ">
    <div class="flex items-center">
      <% if @post.user.avatar.present? %>
        <%= image_tag @post.user.avatar.url, class: 'w-16 h-16 object-cover rounded-full mr-3' %>
      <% end %>
      <span class="font-semibold"><%= @post.user.name %><%= t('.title') %></span>
    </div>
    <h1 class="text-center text-2xl font-bold my-4">「<%= @post.title %>」</h1>
    <!-- メイン画像 -->
    <% if @post.image.present? %>
      <div class="flex justify-center my-6">
        <%= image_tag @post.image.url, alt: 'メイン画像', class: 'max-w-full' %>
      </div>
    <% else %>
      <div class="flex justify-center my-6">
        <div style="width: 300px; height: 200px; background-color: lightgray; text-align: center; line-height: 200px;">
          写真
        </div>
      </div>
    <% end %>
    <!-- 投稿内容 -->
    <h3 class="text-xl font-bold ml-2 mb-2"><%= t('.body') %></h3>
    <div class="bg-white p-4 rounded-lg shadow">
      <%= simple_format(@post.body) %>
    </div>
    <!-- サブ画像 -->
    <% if @post.post_images.present? %>
      <div class="flex flex-wrap justify-center gap-6 my-12">
        <% @post.post_images.each do |post_image| %>
          <div class="flex flex-col items-center x-[420]">
            <%= image_tag post_image.image.url, alt: 'サブ画像', class: 'w-full object-cover rounded-lg mb-2' %>
            <% if post_image.caption.present? %>
              <p class="w-full text-center bg-white p-3 mt-1 rounded-lg shadow">
                <%= post_image.caption %>
              </p>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
    <!-- youtube埋め込み -->
    <% if @post.post_videos.present? %>
      <div class="my-6">
        <% @post.post_videos.each do |post_video| %>
          <div class="flex flex-wrap justify-center mb-4">
            <div class="w-full max-w-xl">
              <%= content_tag 'iframe', nil,
                            width: '100%',
                            height: '315',
                            src: "https://www.youtube.com/embed/#{post_video.youtube_url}",
                            frameborder: '0',
                            gesture: 'media',
                            allow: 'encrypted-media',
                            allowfullscreen: true,
                            class: 'w-full' %>
              <% if post_video.caption.present? %>
                <p class="text-center bg-white p-3 mt-3 rounded-lg shadow">
                  <%= post_video.caption %>
                </p>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
    <!-- Xシェアボタン -->
    <div class="flex justify-center my-12">
      <% encode_text = URI.encode_www_form_component("【シェアスキ！】\nわたしの好き「#{@post.title}」を投稿しました！") %>
      <% twitter_share_url = "https://twitter.com/intent/tweet?url=#{CGI.escape(post_url(@post))}&text=#{encode_text}%0A%0A&hashtags=シェアスキ" %>
      <%= link_to twitter_share_url, target: '_blank', rel: 'noopener', class: 'bg-slate-900 hover:bg-slate-600 text-white py-2 px-10 rounded-full flex items-center gap-2' do %>
        <%= image_tag 'logo-white.png', alt: 'X Logo', style: 'width: 15px; height: 15px;' %>
        シェア
      <% end %>
    </div>
    <!-- コメントフォーム -->
    <div class="mt-8">
      <h3 class="text-xl font-bold mb-2 ml-2"><%= t('comments.create.title') %></h3>
      <% if user_signed_in? %>
        <%= render 'comments/form', post: @post %>
      <% end %>
      <!-- コメント一覧 -->
      <div class="mt-6">
        <%= render @comments %>
      </div>
    </div>
    <!-- カテゴリ -->
    <% if @post.categories.present? %>
      <div class="mt-2 space-y-1">
        <% @post.categories.each do |category| %>
          <div class="inline-block px-2 py-1 bg-gray-100 rounded-md text-sm">
            <%= category.name %>
          </div>
        <% end %>
      </div>
    <% end %>
    <!-- 編集・削除（投稿者のみ) -->
    <% if user_signed_in? && current_user.own?(@post) %>
      <div class="flex justify-center gap-4 mt-6">
        <%= link_to t('helpers.submit.edit'), edit_post_path(@post), class: 'btn btn-primary' %>
        <%= link_to t('helpers.submit.delete'), post_path(@post),
                    data: { turbo_method: :delete, turbo_confirm: t('helpers.confirm.delete') },
                    class: 'btn btn-danger' %>
      </div>
    <% end %>
  </div>
</div>